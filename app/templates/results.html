<html>

<head>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="/static/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/static/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="/static/slick/slick-theme.css"/>
</head>

<body>
    <div class="nav">
        <img class="nav-img" src="static/images/Urban_Gems.png" />
       
    </div>
    
    <div class="results_main">
        <div class="results_overview">
            <p>Urban gems in 
                {%for i in range(0, loc_len)%} 
                    <span class="tag">{{location[i]}}</span>
                {%endfor%}
                featuring
                {%for i in range(0, feat_len)%} 
                    <span class="tag">{{features[i]}}</span>
                {%endfor%}
            </p>

        <div class="panels_container">
                <div>
                    {%for result in proto_results %}
                        <div class="preview_panel" onclick="showExpanded({{result}},  {{ loop.index0 }})"> 
                                {% for key, value in result.items() %}
                                    <!-- <div class="prev_img" style="background-image: url({{value.photo}});"></div> -->
                                    <div class="prev_info">
                                            <h2 class="type">{{value.type}}</h2>
                                            <h1 class="title">{{key}}</h1>
                                        
                                            <span class="rating">   
                                                {%for i in range(0, (value.rating|float|round|int) ) %}
                                                    <span class="fa fa-star checked"></span>
                                                {%endfor%}
                                                {%for i in range(0, 5-(value.rating|float|round|int) )%}
                                                    <span class="fa fa-star"></span>
                                                {%endfor%}
                                            </span>
                                            <span class="tag preview_panel_loc">{{value.boro}}</span>
                                        </div>
                                {%endfor%}
                            </div>
                        {%endfor%}
                    </div>
        </div> 
        </div>

        <div class="results_expanded">
            <div class="expanded_header">
                <div class="expanded_title">
                        
                </div>
            </div>
            <div class="expanded_desc">
                <!-- <div class="amenities expanded_desc_section">
                    <div class="amenities_title"></div>
                    <div class="amenities_items"></div>
                </div> -->

                <div class="expanded_desc_section" style="border-bottom: none;">
                        <div class="subtitle"></div>
                        <div class="sub_items">
        
                        </div>
                </div>

                <div class="reviews expanded_desc_section">
                    <div class="reviews_title">Reviews</div>
                    <div class="reviews_section">
                        <div class="reviews_items"></div>
                    </div>
                   
                </div>

               

                <div class="map expanded_desc_section">
                        <div class="map_title"></div>
                        <div class="map_items">
        
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="/static/slick/slick.min.js"></script>

    <script type="text/javascript">

        function showExpanded(i, index){
            var result_all = '{{proto_results | tojson}}'
            var parsed = JSON.parse(result_all)
            $(".map_items").empty()
            $(".expanded_title").empty()
            $(".subtitle").empty()
            $(".reviews_items").remove()
           
            var name = Object.keys(i)[0]
        
            var result = i[name]
            var img = result.photo
            var area = result.boro
            var reviews = parsed[index][name].reviews

            console.log(parsed[index][name].amenities)
            var rating = Math.round(result.rating)
            $(".expanded_header").css("background-image", 'url('+img+')')
            $(".expanded_title").text(name)

            $(".expanded_title").append('<div class="star_rating"></div>')
            for (i=0; i<rating; i++){
                $(".star_rating").append('<span class="fa fa-star checked"></span>');
            }
            for(i=0; i<(5-rating); i++){
                $(".star_rating").append('<span class="fa fa-star"></span>');
            }
            $(".subtitle").append('<span class="tag" style="float: right;">'+area+'</span>')
            $(".reviews_section").append('<div class="reviews_items"></div>')
            
            if(reviews.length>0){
                reviews.forEach(function(r){
                    $(".reviews_title").text('Reviews')
                    $(".reviews_items").append('<div><div class="review_text">'+r[0]+'</div><div class="review_rating">'+r[1]+'</div></div>')
                    $(".review_rating").empty()
                    for (i=0; i<parseInt(r[1]); i++){
                        $(".review_rating").append('<span class="fa fa-star checked"></span>');
                    }
                    for(i=0; i<(5-parseInt(r[1])); i++){
                         $(".review_rating").append('<span class="fa fa-star"></span>');
                    }
                })
            }
            else {
                $(".reviews_items").text(result.text)
                $(".reviews_title").text('Summary')
            }
           
            $(".map_items").append('<iframe width="100%" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBYcuFsV7KTFtJsVKVFcrOEhKYhqpv8V7Y&q= '+ result.address+', NY, NY" allowfullscreen></iframe>')
            $('.reviews_items').slick({
                dots: true,
                autoplay: true,
                arrows: false,
                autoplaySpeed: 5000
            });
        }

        function drawStars(rating){
            for (i=0; i<rating; i++){
                $(".rating").append('<span class="fa fa-star checked"></span>');
            }
            for(i=0; i<(5-rating); i++){
                $(".rating").append('<span class="fa fa-star"></span>');
            }
        }

        $( document ).ready(function() {
            var json = '{{proto_results[0] | tojson}}'
            var parsed = JSON.parse(json)
            showExpanded(parsed, 0)
           
        })

      
    </script>
</body>

</html>